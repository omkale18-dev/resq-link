# ResQ-Link — Rescue Coordination Assistant
⛑️ ResQ-Link: An autonomous AI Command Node for disaster response. 

Welcome to ResQ-Link — a compact, local rescue coordination assistant that blends deterministic safety checks with helpful AI to triage incidents, log them, and help coordinate emergency responses.

Imagine a lightweight dispatcher in your pocket: you type what happened, and ResQ‑Link routes your report through specialized agents (Supervisor, Triage, Logistics, Medical), logs incidents when necessary, and returns clear, actionable guidance.

-- Quick links
- `app.py` — Streamlit frontend (chat UI)
- `agents.py` — Agent graph and core logic (Supervisor, Triage, Logistics, Medical)
- `tools.py` — Local tools (SQLite-backed `log_incident`, `check_inventory`, `search_shelters`)
- `resq_link.db` — SQLite database generated by the app (incidents, inventory)
- `tests/test_agents.py` — Smoke tests for agent flows
- `scripts/inspect_incidents.py` — Inspect recent incidents

## What it does (at a glance)
- Accepts conversational inputs (e.g., "I'm trapped in a basement, bleeding")
- Supervisor chooses the right specialist (Triage/Logistics/Medical)
- Triage detects clear emergencies and logs incidents automatically (saves Incident ID)
- Logistics can check inventory or look for nearby shelters
- Medical provides concise first‑aid and escalation advice

## Why this approach
ResQ‑Link aims to be both reliable and practical:
- Deterministic safety checks ensure that clear emergencies are handled immediately (no back-and-forth).
- AI helps with ambiguous or complex cases where human-like judgment or phrasing helps.
- The system uses simple tools and a SQLite DB so it can run offline on a laptop or small server.


## Detailed architecture

- Frontend: `app.py` (Streamlit) — handles chat UI, session state, and streaming graph outputs into chat bubbles.
- Orchestration: `agents.py` — builds a small StateGraph (langgraph). Nodes:
	- `Supervisor`: chooses which agent handles the next step.
	- `Triage`: evaluates severity & logs incidents when criteria are met (deterministic pre-checks).
	- `Logistics`: uses `check_inventory` and `search_shelters` tools.
	- `Medical`: provides first-aid advice.
	- `Tools`: wraps tool invocations and returns tool outputs to the graph.
- Tools: defined in `tools.py` using LangChain tool wrappers. Primary tools:
	- `log_incident(severity, location, needs)` — writes to `resq_link.db` and returns an Incident ID string.
	- `check_inventory(item_query)` — queries `inventory` table and returns a Markdown table.
	- `search_shelters(location)` — performs a web search for nearby shelters (requires network access and community package).

## Installation (Windows / PowerShell)
Copy-paste these steps into PowerShell from the project root:

```powershell
# 1) Create & activate a Python 3.11 venv
py -3.11 -m venv .venv
. .\.venv\Scripts\Activate.ps1

# 2) Upgrade packaging tools and install deps
python -m pip install --upgrade pip setuptools wheel
pip install -r requirements.txt

# 3) Optional: tabulate for pandas.to_markdown
pip install tabulate

# 4) Start the app
.\.venv\Scripts\python -m streamlit run app.py
```

If `py -3.11` isn't available, make sure you have Python 3.11 installed and use the appropriate launcher.

## Example interactions (what to type and what to expect)
- User: "I'm trapped in a basement at Sector A, Building B — bleeding heavily."  
	System: Triage detects 'critical' + location and logs an incident, returning first-aid steps and an Incident ID.

- User: "A dog bite on my left hand, minor — need first aid."  
	System: Triage returns basic first-aid steps and logs a minor incident.

- User: "Do you have water packs at Shelter A?"  
	System: Logistics checks inventory and returns a markdown table or suggests searching nearby shelters.

## Developer notes & gotchas
- Gemini (via `langchain_google_genai`) requires at least one non-system message; the code ensures this by adding a fallback `HumanMessage` when necessary.
- Some LangChain `@tool` wrappers are not direct callables — `agents.py` includes a safe invoker helper to call `.run()`, `.invoke()`, or the callable as needed.
- If Streamlit raises `IndentationError`, inspect the `app.py` edits around any reported line — an empty `if` block or mis-indentation can cause this.

Common troubleshooting:
- `pyarrow` / build errors: Use Python 3.11 in the venv to get prebuilt wheels.
- `ImportError: Missing optional dependency 'tabulate'`: run `pip install tabulate` in the venv.
- `Triage no content messages` errors: fixed by ensuring a non-system message is always sent.

## Tests and quick checks
- Run the smoke tests (verifies Supervisor/Triage/Logistics/Medical flows):
```powershell
python .\tests\test_agents.py
```

- Inspect the last recorded incidents:
```powershell
python .\scripts\inspect_incidents.py
```

## Security & privacy
- Incident records can contain sensitive location and medical info — keep `resq_link.db` private and consider encrypted storage for production use.

## Next improvements you might want
- Better location parsing (regex/NER) for address extraction.
- Incident update/cancel API and UI in `app.py`.
- SMS / voice integration for outbound alerts (Twilio or similar).


